@startuml 
title DST : Node Arrival\n

note left of New_node: node()
activate New_node #AntiqueWhite
New_node -> New_node: Join
activate New_node #Orange
note left of New_node: join()
New_node -> Contact: Cnx_req

activate Contact #CadetBlue
Contact -> Leader: Cnx_req
note left of Contact: cnx_req()

<<<<<<< HEAD
activate Leader #CadetBlue
note left of Leader: cnx_req()
=======
activate Leader #FFBBBB
>>>>>>> 94e4a88340e0c314903234191ad29561d3298579
Leader -> Leaders: Br Cs_req
Leaders -[#0000FF]-> Leader: Ack Br Cs_req

Leader -> Leaders: Br Set_upd
Leaders --> Leader: Ack Br Set_upd

<<<<<<< HEAD
activate Leader #SpringGreen
note left of Leader: split_req()
=======
activate Leader #DarkSalmon
>>>>>>> 94e4a88340e0c314903234191ad29561d3298579
Leader -> Tree: Br Add_Stage
Tree --> Leader: Ack Br Add_stage
Leader -> Sub_Tree: Br Split

activate Sub_Tree #Purple
note left of Sub_Tree: Split()
Sub_Tree -> Nodes: Del_pred
Nodes --> Sub_Tree: Ack Del_pred
Sub_Tree -> Nodes: Cnx_groups

activate Nodes #MediumBlue
note left of Nodes: Cnx_groups
Nodes -> Other_Nodes: Del_pred
Other_Nodes --> Nodes: Ack Del_pred
Nodes -> Other_Nodes: Add_pred
Other_Nodes --> Nodes: Ack Add_pred

Nodes --> Sub_Tree: Ans Cnx_groups
deactivate Nodes
Sub_Tree --> Leader: Ack Br Split
deactivate Sub_Tree
deactivate Leader

Leader -> Sub_Tree: Br Set_active
Sub_Tree --> Leader: Ack Br Set_active
Leader -> Nodes: New_bro_rcv
Nodes --> Leader: Ack New_bro_rcv
Leader -> Nodes: Set_state

Leader --> Contact: Ans Cnx_req
deactivate Leader

Contact --> New_node: Ans Cnx_req
deactivate Contact

activate New_node #DarkRed
note left of New_node: load_balance()
New_node -> Nodes: Add_pred
New_node -> Nodes: Get_rep

activate Nodes #Red
note left of Nodes: Get_rep()
Nodes -> Other_Nodes: Nb_pred
Other_Nodes --> Nodes: Ans Nb_pred
Nodes --> New_node: Ans Get_rep
deactivate Nodes

New_node -> Nodes: Del_pred
New_node -> Nodes: Add_pred
Nodes --> New_node: Ack Add_pred
New_node -> Nodes: End_get_rep
New_node -> New_node:

deactivate New_node
New_node -> New_node:
deactivate New_node
New_node -> New_node:
deactivate New_node

@enduml
